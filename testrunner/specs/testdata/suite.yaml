actions:
- name: Can load home page
  httpTest:
    url: http://{{.Vars.MainVmIp}}:9012
    expect:
      statusCode:
        equals: 200
      statusText:
        contains: OK
      bodyText:
        html:
          title:
            contains: Hello World!
- name: Can SSH and do basic queries
  sshTest:
    host: '{{.Vars.MainVmIp}}'
    port: 22
    commands:
    - command: [redis, ping]
      expect:
        stdout:
          exactly: PONG
        stderr: &empty
          exactly: ''
    - script: |-
        #!/bin/bash -eu
        redis-cli put MY_KEY MY_VALUE
        redis-cli get MY_KEY
      expect:
        stdout:
          exactly: MY_VALUE
        stderr: *empty
- name: Update success variable
  gcp:
    setRuntimeConfigVar:
      runtimeConfigSelfLink: https://runtimeconfig.googleapis.com/v1beta1/projects/my-project/configs/my-config
      variablePath: status/success
      base64Value: c3VjY2Vzcwo=
- name: Can echo to stdout and stderr
  bashTest:
    script: |-
      echo "Text1"
      >2& echo "Text2"
    expect:
      exitCode:
        - equals: 0
        - notEquals: 1
      stdout:
        - contains: "Text1"
        - notcontains: "Foo"
        - notcontains: "Bar"
        - matches: "T.xt1"
      stderr:
        - contains: "Text2"
        - notcontains: "Foo"
        - notcontains: "Bar"
        - matches: "T.xt2"
